generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "sqlite"
    url      = env("DATABASE_URL")
}

model Hunt {
    id          Int          @id @default(autoincrement())
    createdAt   DateTime     @default(now())
    scheduledAt DateTime?
    completedAt DateTime?
    name        String
    description String
    place       String?
    warnings    String?
    status      String       @default("pending")
    danger      Int          @default(1)
    maxHunters  Int          @default(5)
    minRating   Int          @default(0)
    hunters     Hunter[]
    invites     HuntInvite[]
    photos      Photo[]
    rating      Float?
    comment     String?
    payment     Int
    paidHunters Boolean      @default(false)

    @@index([status])
    @@index([scheduledAt])
}

model Hunter {
    id          Int          @id @default(autoincrement())
    name        String
    handle      String       @unique
    alive       Boolean      @default(true)
    hunts       Hunt[]
    photos      Photo[]      @relation("Photos")
    avatar      Photo?       @relation("Avatar", fields: [avatarId], references: [id])
    avatarId    Int?         @unique
    money       Int          @default(0)
    user        User?        @relation(fields: [userId], references: [id])
    userId      Int?
    groupId     Int?
    group       HunterGroup? @relation(fields: [groupId], references: [id])
    bio         String?
    pronouns    String?
    type        String?
    rating      Float        @default(1)
    invites     HuntInvite[] @relation("Invitee")
    sentInvites HuntInvite[] @relation("Inviter")

    @@index([alive])
}

model HunterGroup {
    id      Int      @id @default(autoincrement())
    name    String
    hunters Hunter[]
}

model HuntInvite {
    id           Int      @id @default(autoincrement())
    fromHunter   Hunter   @relation("Inviter", fields: [fromHunterId], references: [id])
    fromHunterId Int
    toHunter     Hunter   @relation("Invitee", fields: [toHunterId], references: [id])
    toHunterId   Int
    hunt         Hunt     @relation(fields: [huntId], references: [id])
    huntId       Int
    createdAt    DateTime @default(now())
    expiresAt    DateTime
    status       String   @default("pending")

    @@unique([fromHunterId, huntId, toHunterId], name: "fromToHunt")
    @@index([toHunterId, status], name: "toHunterStatus")
    @@index([expiresAt])
}

model Photo {
    id       Int     @id @default(autoincrement())
    path     String  @unique
    width    Int
    height   Int
    blurry   String?
    hunter   Hunter? @relation("Photos", fields: [hunterId], references: [id])
    hunterId Int?
    hunt     Hunt?   @relation(fields: [huntId], references: [id])
    huntId   Int?
    avatar   Hunter? @relation("Avatar")

    @@index([huntId, hunterId])
}

model User {
    id        Int     @id @default(autoincrement())
    password  String  @unique
    name      String?
    run       Int     @default(1)
    hideMoney Boolean @default(false)

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
    hunters   Hunter[]
}
